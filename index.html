<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Bar</title>
  <style>
    :root { --accent: #007bff; --border: #d0d0d0; --bg-head: #f4f4f4; --err: #c00; }
    body { position: relative; font-family: system-ui, sans-serif; margin: 1.5rem; line-height: 1.5; }
    .lang-switch { position: absolute; top: 1rem; right: 1rem; display: flex; gap: 0.5rem; }
    .lang-switch img { width: 24px; height: 24px; cursor: pointer; border: 1px solid transparent; border-radius: 0.25rem; }
    .lang-switch img.active { border-color: var(--accent); }
    h1, h2 { margin-top: 1.5rem; font-size: 1.8rem; }
    h2 { font-size: 1.4rem; }
    a { color: var(--accent); text-decoration: none; cursor: pointer; }
    a:hover { text-decoration: underline; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.5rem; border: 1px solid var(--border); }
    th { background: var(--bg-head); text-align: left; }
    .back { margin-bottom: 1rem; }
    .back a { font-size: 0.9rem; }
    .err { color: var(--err); }
  </style>
</head>
<body>
  <div class="lang-switch">
    <img id="lang-en" src="Lang/flag-en.png" alt="EN" class="active">
    <img id="lang-cs" src="Lang/flag-cs.png" alt="CS">
  </div>
  <div id="app"></div>

  <script>
    const CURRENCY = '€';
    let lang = 'en';

    async function loadData() {
      const inventory = await fetch('bar-data.json').then(r => r.json());
      const texts = await fetch('i18n.json').then(r => r.json());
      const drinks = Object.fromEntries(
        inventory.filter(i => i.abv <= 0.05).map(i => [
          i.name,
          {
            name: i.name,
            volumeMl: i.volumeMl,
            alcPercent: +(i.abv * 100).toFixed(1),
            price: +(i.pricePerMl * i.volumeMl).toFixed(2),
            available: i.inStock,
            description: i.description
          }
        ])
      );
      const shots = inventory
        .filter(i => i.abv > 0.05)
        .map(i => ({
          name: i.name,
          alcPercent: +(i.abv * 100).toFixed(1),
          price: +(i.pricePerMl * 40).toFixed(2),
          available: i.inStock
        }));
      return { drinks, shots, texts };
    }

    function statusDot(d) {
      const color = d.available ? 'green' : 'red';
      return `<span style="display:inline-block;width:0.75rem;height:0.75rem;
              background:${color};border-radius:50%;"></span>`;
    }

    function t(key) {
      return barData.texts[lang][key] || key;
    }

    async function init() {
      window.barData = await loadData();
      router();
    }

    function renderList() {
      const { drinks, shots } = barData;
      const app = document.getElementById('app');
      app.innerHTML = `<h1>${t('drinks')}</h1>`;

      // --- seznam drinků ---
      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>${t('drink')}</th>
            <th style="text-align:center">${t('availability')}</th>
            <th>${t('price')}</th>
          </tr>
        </thead>`;
      const tbody = document.createElement('tbody');

      Object.values(drinks)
        .sort((a, b) => a.name.localeCompare(b.name))
        .forEach(d => {
          // pokud je nealko, přidáme ikonu
          const icon = d.alcPercent === 0
            ? '<img src="img/AlcoholFree.png" alt="Nealko" ' +
              'style="width:16px; vertical-align:middle; margin-left:4px;">'
            : '';

          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>
              <a data-drink="${d.name}">${d.name}${icon}</a>
            </td>
            <td style="text-align:center">${statusDot(d)}</td>
            <td>${CURRENCY}${d.price.toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        });

      table.appendChild(tbody);
      app.appendChild(table);

      // --- seznam shotů (beze změny) ---
      if (shots.length) {
        app.insertAdjacentHTML('beforeend', `<h2>${t('shots')}</h2>`);
        const st = document.createElement('table');
        st.innerHTML = `
          <thead>
            <tr>
              <th>${t('drink')}</th>
              <th style="text-align:center">${t('availability')}</th>
              <th>${t('price')}</th>
            </tr>
          </thead>`;
        const sb = document.createElement('tbody');
        shots.forEach(s => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><a data-shot="${s.name}">${s.name}</a></td>
            <td style="text-align:center">${statusDot(s)}</td>
            <td>${CURRENCY}${s.price.toFixed(2)}</td>
          `;
          sb.appendChild(tr);
        });
        st.appendChild(sb);
        app.appendChild(st);
      }
    }

    function renderDetails(name) {
      const d = barData.drinks[name];
      const app = document.getElementById('app');

      // ikona pro nealko i zde
      const icon = d.alcPercent === 0
        ? '<img src="img/AlcoholFree.png" alt="Nealko" ' +
          'style="width:20px; vertical-align:middle; margin-left:8px;">'
        : '';

      app.innerHTML = `
        <div class="back"><a data-back>${t('back')}</a></div>
        <h1>${d.name}${icon}</h1>
        <p>${statusDot(d)} <strong>${
          d.available ? t('available') : t('notAvailable')
        }</strong></p>
        <p>${t('volume')}: ${d.volumeMl} ml</p>
        <p>${t('abv')}: ${d.alcPercent}%</p>
        <p>${t('price')}: ${CURRENCY}${d.price.toFixed(2)}</p>
      `;

      // tabulka detailů shotů, přísad apod. (původní kód beze změny)
      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>${t('ingredient')}</th>
            <th style="text-align:center">${t('amount')}</th>
          </tr>
        </thead>`;
      const tbody = document.createElement('tbody');
      d.ingredients.forEach(ing => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${ing.name}</td>
          <td style="text-align:center">${ing.amountMl} ml</td>
        `;
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      app.appendChild(table);

      // popis (pokud existuje)
      const desc = d.description[lang];
      if (desc) {
        const descEl = document.createElement('p');
        descEl.innerHTML = `<strong>${t('description')}:</strong> ${desc}`;
        app.appendChild(descEl);
      }
    }

    const router = () => {
      const params = new URLSearchParams(location.search);
      const drink = params.get('drink');
      if (drink && barData.drinks[drink]) {
        renderDetails(drink);
      } else {
        renderList();
      }
    };

    document.body.addEventListener('click', e => {
      const a = e.target.closest('a[data-drink], a[data-shot], a[data-back]');
      if (!a) return;
      e.preventDefault();
      if (a.dataset.back !== undefined) {
        history.pushState({}, '', location.pathname);
      } else if (a.dataset.drink) {
        history.pushState({}, '', `?drink=${encodeURIComponent(a.dataset.drink)}`);
      } else if (a.dataset.shot) {
        // případně handle shot detail
      }
      router();
    });

    document.getElementById('lang-en').addEventListener('click', () => {
      lang = 'en';
      document.getElementById('lang-en').classList.add('active');
      document.getElementById('lang-cs').classList.remove('active');
      router();
    });
    document.getElementById('lang-cs').addEventListener('click', () => {
      lang = 'cs';
      document.getElementById('lang-cs').classList.add('active');
      document.getElementById('lang-en').classList.remove('active');
      router();
    });

    (async () => {
      try {
        document.getElementById('app').textContent = barData
          ? ''
          : t('loading');
        await init();
      } catch (e) {
        document.getElementById('app').innerHTML = `<p class="err">${e.message}</p>`;
        console.error(e);
      }
    })();
  </script>
</body>
</html>
