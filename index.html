<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bar Drinks</title>
  <style>
    :root{--accent:#037bfa;--bg:#fafafa;--border:#d7d7d7}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);color:#222}
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid var(--border);background:#fff;position:sticky;top:0;z-index:2}
    h1{font-size:1.4rem;margin:0}
    #langSel{font-size:.9rem;padding:.3rem .5rem}
    main{padding:1rem;max-width:900px;margin:auto}
    table{width:100%;border-collapse:collapse;margin:.5rem 0}
    th,td{border:1px solid var(--border);padding:.5rem;text-align:left;font-size:.9rem}
    th{background:var(--bg)}
    tr.clickable{cursor:pointer;transition:background .2s}
    tr.clickable:hover{background:rgba(0,0,0,.05)}
    .avail-dot{display:inline-block;width:.8em;height:.8em;border-radius:50%;margin-right:.4em;vertical-align:middle}
    .y{background:#0a0}
    .n{background:#c00}
    .detail{display:none}
    .detail.active{display:block}
    .detail img{width:100%;max-width:512px;margin:.5rem 0;border-radius:8px}
    .bold{font-weight:600}
  </style>
</head>
<body>
  <header>
    <h1 id="appTitle"></h1>
    <select id="langSel"></select>
  </header>
  <main>
    <section id="listSection">
      <table id="drinkTable">
        <thead><tr><th>Drink</th><th></th><th>Price</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
    <section id="detailSection" class="detail"></section>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    (function(){
      const SHEET_ID = 'YOUR_SHEET_ID_HERE';
      const SHEET_NAME = 'DrinkList';
      const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
      const IMAGE_DIR = 'Drink/';
      const dict = {
        en:{title:'Our Drinks',available:'Available',unavailable:'Missing ingredients',volume:'Volume',abv:'ABV',price:'Price',ingredient:'Ingredient',amount_ml:'ml',abv_short:'%',in_stock:'In stock',popis:'Description',back:'← Back',currency:'€'},
        cs:{title:'Naše drinky',available:'Dostupný',unavailable:'Chybí ingredience',volume:'Objem',abv:'Obsah alkoholu',price:'Cena',ingredient:'Ingredience',amount_ml:'ml',abv_short:'%',in_stock:'Skladem',popis:'Popis',back:'← Zpět',currency:'€'}
      };
      const langSel = document.getElementById('langSel');
      const appTitle = document.getElementById('appTitle');
      const tableBody = document.querySelector('#drinkTable tbody');
      const detailSec = document.getElementById('detailSection');
      let lang = localStorage.getItem('lang') || ((navigator.language||'en').toLowerCase().startsWith('cs')?'cs':'en');
      let drinks = [];
      function applyLang(){
        const tr = dict[lang];
        appTitle.textContent = tr.title;
        if(!langSel.options.length){
          Object.keys(dict).forEach(k=>{const o=new Option(k.toUpperCase(),k);langSel.add(o)});
        }
        langSel.value = lang;
        if(detailSec.classList.contains('active') && detailSec.dataset.id){
          showDetail(drinks.find(d=>d.id===detailSec.dataset.id));
        } else {
          renderList();
        }
      }
      langSel.addEventListener('change',()=>{lang=langSel.value;localStorage.setItem('lang',lang);applyLang()});
      function rowToDrink(row,i){
        const name=row['Name']?.trim(); if(!name) return null;
        const ingr=[]; Object.keys(row).forEach(k=>{if(k.endsWith(' ml')){const base=k.slice(0,-3);const ml=+row[k]||0;if(ml){ingr.push({title:base,ml,abv:+row[base+' abv']||0,cost:+row[base+' price']||0,in_stock:!(row[base+' stock']||'').toLowerCase().includes('no')});}}});
        let volume=0,alcMl=0,cost=0;ingr.forEach(x=>{volume+=x.ml;alcMl+=x.ml*x.abv/100;cost+=x.cost});
        const d={id:name,name,ingredients:ingr,volume,abv:volume?alcMl/volume*100:0,price:cost,available:ingr.every(x=>x.in_stock)};
        // find image
        ['.jpg','.jpeg','.png','.jxl'].forEach(ext=>{const p=IMAGE_DIR+name+ext;if(!d.img) d.img=p});
        return d;
      }
      function loadData(){
        return fetch(CSV_URL).then(r=>r.ok?r.text():Promise.reject()).catch(()=>Promise.resolve('')).then(csv=>{
          const data = Papa.parse(csv,{header:true}).data;
          const desc={cs:{},en:{}};
          data.forEach((row,i)=>{
            if(i===998||i===999){const key=i===998?'cs':'en';Object.keys(row).forEach(k=>row[k]?desc[key][k.trim()]=row[k]:null)} else {
              const d=rowToDrink(row,i); if(d) drinks.push(d);
            }
          });
          drinks.forEach(d=>d.description={cs:desc.cs[d.name]||'',en:desc.en[d.name]||''});
        });
      }
      function renderList(){
        tableBody.innerHTML=''; const tr=dict[lang];
        drinks.forEach(d=>{
          const row=document.createElement('tr'); row.className='clickable'; row.dataset.id=d.id;
          row.onclick=()=>showDetail(d);
          const dot=`<span class="avail-dot ${d.available?'y':'n'}" title="${d.available?tr.available:tr.unavailable}"></span>`;
          row.innerHTML=`<td>${d.name}</td><td>${dot}</td><td>${tr.currency}${d.price.toFixed(2)}</td>`;
          tableBody.appendChild(row);
        });
      }
      function showDetail(d){
        const tr=dict[lang]; detailSec.innerHTML=''; detailSec.dataset.id=d.id; detailSec.classList.add('active');
        document.getElementById('listSection').style.display='none';
        let html=`<button onclick="hideDetail()">${tr.back}</button><h2>${d.name}</h2><p><span class='avail-dot ${d.available?'y':'n'}' title=''></span>${d.available?tr.available:tr.unavailable}</p>`;
        html+=`<p>${tr.volume}: ${d.volume} ${tr.amount_ml}</p><p>${tr.abv}: ${d.abv.toFixed(2)}${tr.abv_short}</p><p>${tr.price}: ${tr.currency}${d.price.toFixed(2)}</p>`;
        html+=`<h3>${tr.ingredient}</h3><table><thead><tr><th>${tr.ingredient}</th><th>${tr.amount_ml}</th><th>${tr.abv} ${tr.abv_short}</th><th>${tr.in_stock}</th></tr></thead><tbody>`;
        d.ingredients.forEach(ing=>{html+=`<tr><td>${ing.title}</td><td>${ing.ml}</td><td>${ing.abv}</td><td>${ing.in_stock?'✓':'✗'}</td></tr>`});
        html+='</tbody></table>';
        if(d.img) html+=`<img src='${d.img}' alt='${d.name}' onerror="this.style.display='none'">`;
        const desc=d.description[lang]; if(desc) html+=`<p><span class='bold'>${tr.popis}</span><br>${desc}</p>`;
        detailSec.innerHTML=html;
      }
      window.hideDetail=function(){detailSec.classList.remove('active');document.getElementById('listSection').style.display='block'};
      loadData().then(()=>{applyLang();renderList();});
    })();
  </script>
</body>
</html>
