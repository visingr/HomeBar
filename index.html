<!DOCTYPE html>
<html lang="">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bar Drinks</title>
<style>
:root{
  --accent:#037bfa;
  --bg:#fafafa;
  --border:#d7d7d7;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui, sans-serif;background:var(--bg);color:#222;}
header{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid var(--border);background:#fff;position:sticky;top:0;z-index:2;}
h1{font-size:1.4rem;margin:0;}
#langSel{font-size:.9rem;padding:.3rem .5rem;}
main{padding:1rem;max-width:900px;margin:auto;}
.drink-list{display:grid;gap:1rem;}
.drink-card{padding:1rem;border:1px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;transition:box-shadow .2s}
.drink-card:hover{box-shadow:0 2px 6px rgba(0,0,0,.1);}
.avail{display:inline-block;width:.8em;height:.8em;border-radius:50%;margin-right:.4em;vertical-align:middle;}
.avail.y{background:#0a0;}
.avail.n{background:#c00;}
.detail{display:none;}
.detail.active{display:block;}
.detail img{width:100%;max-width:512px;margin:.5rem 0;border-radius:8px;}
table{width:100%;border-collapse:collapse;margin:.5rem 0;}
th,td{border:1px solid var(--border);padding:.4rem;text-align:left;font-size:.9rem;}
th{background:var(--bg);}
.bold{font-weight:600;}
.hidden{display:none;}
</style>
</head>
<body>
<header>
  <h1 id="appTitle"></h1>
  <select id="langSel"></select>
</header>
<main>
  <section id="listSection">
    <div class="drink-list" id="drinkList"></div>
  </section>
  <section id="detailSection" class="detail"></section>
</main>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
(function(){
/* ------------------ CONFIG -------------------- */
const SHEET_ID = 'YOUR_SHEET_ID_HERE';    // <-- put your google sheet id here
const SHEET_NAME = 'DrinkList';
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
const IMAGE_DIR = 'Drink/';               // relative folder with images

/* ------------- TRANSLATION DICT -------------- */
const dict = {
  en:{
    title:'Our Drinks',
    available:'Available',
    unavailable:'Missing ingredients',
    volume:'Volume',
    abv:'ABV',
    price:'Price',
    ingredient:'Ingredient',
    amount_ml:'ml',
    abv_short:'%',
    in_stock:'In stock',
    popis:'Description',
    back:'← Back',
    currency:'€'
  },
  cs:{
    title:'Naše drinky',
    available:'Dostupný',
    unavailable:'Chybí ingredience',
    volume:'Objem',
    abv:'Obsah alkoholu',
    price:'Cena',
    ingredient:'Ingredience',
    amount_ml:'ml',
    abv_short:'%',
    in_stock:'Skladem',
    popis:'Popis',
    back:'← Zpět',
    currency:'€'
  }
};

/* -------------- STATE & LANG ----------------- */
const langSel = document.getElementById('langSel');
const appTitle = document.getElementById('appTitle');
const listEl = document.getElementById('drinkList');
const detailSec = document.getElementById('detailSection');
let lang = localStorage.getItem('lang') ||
           (navigator.language||'en').toLowerCase().startsWith('cs')?'cs':'en';
function applyLangLabels(){
  const tr = dict[lang];
  appTitle.textContent = tr.title;
  // build language select if empty
  if(!langSel.options.length){
    for(const k of Object.keys(dict)){
      const o = document.createElement('option');
      o.value=k; o.textContent=k.toUpperCase();
      langSel.appendChild(o);
    }
  }
  langSel.value=lang;
  // update detail if visible
  if(detailSec.classList.contains('active')){
    const drinkId = detailSec.dataset.id;
    showDetail(drinks.find(d=>d.id===drinkId));
  }
}
langSel.addEventListener('change', e=>{
  lang = e.target.value;
  localStorage.setItem('lang',lang);
  applyLangLabels();
});
/* -------------- DATA MODEL ------------------- */
let drinks=[];
/* Dummy fallback data so page works without sheet */
const fallbackCSV = `
Name,Volume,Price,Islandic Vodka ml,Islandic Vodka abv,Islandic Vodka price,Blue Curacao ml,Blue Curacao abv,Blue Curacao price,Lemonade ml,Lemonade abv,Lemonade price
Blue Lagoon,180,,40,38,0.4,20,20,0.25,120,0,0.25
`;
/* parse CSV row into drink object */
function rowToDrink(row, idx){
  const name = row['Name'].trim();
  if(idx===998||idx===999){ // descriptions rows
    return null;
  }
  const ingr = [];
  Object.keys(row).forEach(k=>{
    if(k.includes(' ml')){
      const base = k.replace(/ ml$/,'');
      const ml=parseFloat(row[k]||0);
      if(!ml) return;
      const abv=parseFloat(row[base+' abv']||0);
      const cost=parseFloat(row[base+' price']||0);
      const in_stock=!(row[base+' stock']||'').toLowerCase().includes('no');
      const title=base;
      ingr.push({title,ml,abv,cost,in_stock});
    }
  });
  // calculate totals
  let volume=0, alcMl=0, cost=0;
  ingr.forEach(ing=>{
    volume+=ing.ml;
    alcMl+=ing.ml*ing.abv/100;
    cost+=ing.cost;
  });
  const abv = volume? (alcMl/volume*100):0;
  // detect availability
  const available = ingr.every(ing=>ing.in_stock);
  // pick image path
  const imgCandidate = name;
  const exts=['.jpg','.jpeg','.png','.jxl','.JPG','.JPEG','.PNG','.JXL'];
  const img=exts.map(ext=>IMAGE_DIR+imgCandidate+ext)[0];
  return {id:name,name,ingredients:ingr,volume,abv,price:cost,available,img};
}
/* ---------- loadData gets CSV from sheet ------ */
function loadData(){
  return new Promise(res=>{
    fetch(CSV_URL).then(r=>r.ok?r.text():Promise.reject())
    .then(csv=>{
      res(csv);
    }).catch(()=>{
      res(fallbackCSV); // fallback
    });
  }).then(csv=>{
    const data = Papa.parse(csv,{header:true}).data;
    const descCs={}, descEn={};
    data.forEach((row,i)=>{
      if(i===998){
        Object.keys(row).forEach(k=>{
          if(k){descCs[k.trim()]=row[k];}
        });
      }else if(i===999){
        Object.keys(row).forEach(k=>{
          if(k){descEn[k.trim()]=row[k];}
        });
      }else{
        const d=rowToDrink(row,i);
        if(d) drinks.push(d);
      }
    });
    // attach descriptions
    drinks.forEach(d=>{
      d.description={cs:descCs[d.name]||'',en:descEn[d.name]||''};
    });
  });
}
/* -------------- RENDER ----------------------- */
function renderList(){
  listEl.innerHTML='';
  const tr=dict[lang];
  drinks.forEach(d=>{
    const card=document.createElement('div');
    card.className='drink-card';
    card.innerHTML=`<span class="avail ${d.available?'y':'n'}" title="${d.available?tr.available:tr.unavailable}"></span>${d.name}`;
    card.onclick=()=>showDetail(d);
    listEl.appendChild(card);
  });
}
function showDetail(d){
  const tr=dict[lang];
  detailSec.dataset.id=d.id;
  detailSec.classList.add('active');
  listEl.closest('#listSection').classList.add('hidden');
  const availLabel = d.available?tr.available:tr.unavailable;
  const availDot = `<span class="avail ${d.available?'y':'n'}" title="${availLabel}"></span>${availLabel}`;
  let html = `<button onclick="hideDetail()" style="margin-bottom:.7rem">${tr.back}</button>`;
  html += `<h2>${d.name}</h2><p>${availDot}</p>`;
  html += `<p>${tr.volume}: ${d.volume} ${tr.amount_ml}</p>`;
  html += `<p>${tr.abv}: ${d.abv.toFixed(2)}${tr.abv_short}</p>`;
  html += `<p>${tr.price}: ${tr.currency}${d.price.toFixed(2)}</p>`;
  html += `<h3>${tr.ingredient}</h3>`;
  html += `<table><thead><tr><th>${tr.ingredient}</th><th>${tr.amount_ml}</th><th>${tr.abv} ${tr.abv_short}</th><th>${tr.in_stock}</th></tr></thead><tbody>`;
  d.ingredients.forEach(ing=>{
    html+=`<tr><td>${ing.title}</td><td>${ing.ml}</td><td>${ing.abv}</td><td>${ing.in_stock?'✓':'✗'}</td></tr>`;
  });
  html+='</tbody></table>';
  if(d.img){
    html+=`<img src="${d.img}" alt="${d.name}" onerror="this.style.display='none'">`;
  }
  const desc = d.description[lang]||'';
  if(desc){
    html+=`<p><span class="bold">${tr.popis}</span><br>${desc}</p>`;
  }
  detailSec.innerHTML=html;
}
window.hideDetail=function(){
  detailSec.classList.remove('active');
  listEl.closest('#listSection').classList.remove('hidden');
}
loadData().then(()=>{
  applyLangLabels();
  renderList();
});
})();</script>
</body>
</html>
